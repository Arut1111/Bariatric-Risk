
import streamlit as st
import matplotlib.pyplot as plt
import numpy as np

st.set_page_config(page_title="–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π", page_icon="‚ö†Ô∏è", layout="centered")
st.title("‚ö†Ô∏è –ü—Ä–æ–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å —Ä–∏—Å–∫–∞ –ø–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π")

st.markdown("""–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ –±–∞—Ä–∏–∞—Ç—Ä–∏—á–µ—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.
–ê–ª–≥–æ—Ä–∏—Ç–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º—É–ª—É –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏, –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏.""")

with st.form("risk_form"):
    hb = st.number_input("–ì–µ–º–æ–≥–ª–æ–±–∏–Ω (–≥/–ª)", min_value=0.0, step=0.1)
    vas = st.slider("–ë–æ–ª—å –ø–æ –í–ê–® (0‚Äì10)", 0.0, 10.0, 3.0, step=0.1)
    drain = st.checkbox("–û–±—ä—ë–º –¥—Ä–µ–Ω–∞–∂–∞ ‚â• 70 –º–ª/—Å—É—Ç")
    neutro = st.number_input("–ü–∞–ª–æ—á–∫–æ—è–¥–µ—Ä–Ω—ã–µ –Ω–µ–π—Ç—Ä–æ—Ñ–∏–ª—ã (%)", min_value=0.0, step=0.1)
    submitted = st.form_submit_button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∏—Å–∫")

if submitted:
    r = -2.86 - 0.053 * hb + 1.687 * vas + 3.146 * int(drain) + 0.167 * neutro
    st.subheader("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç")
    st.metric(label="–†–∞—Å—á—ë—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Ä–∏—Å–∫–∞", value=f"{r:.2f}")
    
    if r >= 0.08:
        st.error("üî¥ –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.")
    else:
        st.success("üü¢ –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π.")

    # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    x = np.linspace(-2, 2, 400)
    y = 1 / (1 + np.exp(-x))
    fig, ax = plt.subplots()
    ax.plot(x, y, label="–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–ª–æ–∂–Ω–µ–Ω–∏—è")
    ax.axvline(r, color='red', linestyle='--', label=f"–¢–µ–∫—É—â–∏–π —Ä–∏—Å–∫ ({r:.2f})")
    ax.set_xlabel("r - –ª–æ–≥–∏—Ç-—Ñ—É–Ω–∫—Ü–∏—è")
    ax.set_ylabel("P (–æ—Å–ª–æ–∂–Ω–µ–Ω–∏–µ)")
    ax.set_title("–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏")
    ax.legend()
    st.pyplot(fig)
