
import streamlit as st
import matplotlib.pyplot as plt
import numpy as np

st.set_page_config(page_title="–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π", page_icon="‚ö†Ô∏è", layout="centered")
st.title("‚ö†Ô∏è –ü—Ä–æ–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å —Ä–∏—Å–∫–∞ –ø–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π")

st.markdown("""–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ –±–∞—Ä–∏–∞—Ç—Ä–∏—á–µ—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.
–ú–æ–¥–µ–ª—å —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–∞—Å—á—ë—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π.""")

with st.form("risk_form"):
    hb = st.number_input("–ì–µ–º–æ–≥–ª–æ–±–∏–Ω (–≥/–ª)", min_value=0.0, step=0.1)
    vas = st.slider("–ë–æ–ª—å –ø–æ –í–ê–® (0‚Äì10)", 0.0, 10.0, 3.0, step=0.1)
    drain = st.checkbox("–û–±—ä—ë–º –¥—Ä–µ–Ω–∞–∂–∞ ‚â• 70 –º–ª/—Å—É—Ç")
    neutro = st.number_input("–ü–∞–ª–æ—á–∫–æ—è–¥–µ—Ä–Ω—ã–µ –Ω–µ–π—Ç—Ä–æ—Ñ–∏–ª—ã (%)", min_value=0.0, step=0.1)
    hr = st.number_input("–ß–∞—Å—Ç–æ—Ç–∞ —Å–µ—Ä–¥–µ—á–Ω—ã—Ö —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π (–ß–°–°)", min_value=0, step=1)
    wbc = st.number_input("–õ–µ–π–∫–æ—Ü–∏—Ç—ã (10‚Åπ/–ª)", min_value=0.0, step=0.1)
        temp = st.number_input("–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ç–µ–ª–∞ (¬∞C)", min_value=34.0, max_value=42.0, step=0.1)
    crp = st.number_input("–°-—Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –±–µ–ª–æ–∫ (–°–†–ë, –º–≥/–ª)", min_value=0.0, step=0.1)
    submitted = st.form_submit_button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∏—Å–∫")

if submitted:
    r = -2.86
    r += -0.053 * hb
    if vas > 4:
        r += 1.687
    r += 3.146 * int(drain)
    r += 0.167 * neutro
    if hr > 100:
        r += 0.05
    if wbc > 14:
        r += 0.07
    if crp > 129.5:
        r += 0.09
    if temp > 38.0:
        r += 0.06

    st.subheader("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç")
    st.metric(label="–†–∞—Å—á—ë—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Ä–∏—Å–∫–∞", value=f"{r:.2f}")

    if r >= 0.08:
        st.error("üî¥ –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.")
    else:
        st.success("üü¢ –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π.")

    x = np.linspace(-2, 2, 400)
    y = 1 / (1 + np.exp(-x))
    fig, ax = plt.subplots()
    ax.plot(x, y, label="–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∫—Ä–∏–≤–∞—è")
    ax.axvline(r, color='red', linestyle='--', label=f"r = {r:.2f}")
    ax.set_xlabel("r - –ª–æ–≥–∏—Ç-—Ñ—É–Ω–∫—Ü–∏—è")
    ax.set_ylabel("P (–æ—Å–ª–æ–∂–Ω–µ–Ω–∏–µ)")
    ax.set_title("–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏")
    ax.legend()
    st.pyplot(fig)
